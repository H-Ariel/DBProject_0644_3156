# DBProject_0644_3156
## ××¢×¨×›×ª × ×™×”×•×œ ××•×©×‘×•×ª ×‘×—×œ×œ

**×©××•×ª ×”××’×™×©×™×:** ××¨×™××œ ×—×œ×™×œ×™ ×•××¨×‘×œ ×¤××¨
**×™×—×™×“×” × ×‘×—×¨×ª:** ×× ×©×™ ×¦×•×•×ª

---
## ×ª×•×›×Ÿ ×¢× ×™×™× ×™×

1. [××‘×•×](#××‘×•×)
   
2. [×©×œ×‘ 1 - ×¢×™×¦×•×‘ ×•×‘× ×™×™×ª ×‘×¡×™×¡ ×”× ×ª×•× ×™×](#×©×œ×‘-1---×¢×™×¦×•×‘-×•×‘× ×™×™×ª-×‘×¡×™×¡-×”× ×ª×•× ×™×)

	2.1 [×ª×¨×©×™× ERD](#×ª×¨×©×™×-erd)
   
	2.2 [×ª×¨×©×™× DSD](#×ª×¨×©×™×-dsd)
   
	2.3 [×©×™×˜×•×ª ×œ×”×›× ×¡×ª ×”× ×ª×•× ×™×](#×©×™×˜×•×ª-×œ×”×›× ×¡×ª-×”× ×ª×•× ×™×)
  
	2.4 [×¦×™×œ×•× ××¡×š ×©×œ ×’×™×‘×•×™](#×¦×™×œ×•×-××¡×š-×’×™×‘×•×™-×”× ×ª×•× ×™×)
 
	2.5 [×¦×™×œ×•× ××¡×š ×©×œ ×©×—×–×•×¨](#×¦×™×œ×•×-××¡×š-×©×œ-×©×—×–×•×¨-×”× ×ª×•× ×™×-×××—×©×‘-××—×¨)
 
3. [×©×œ×‘ 2 - ×©××™×œ×ª×•×ª SQL](#×©×œ×‘-2---×©××™×œ×ª×•×ª-sql)

	3.1 [×©××™×œ×ª×•×ª SELECT](#×©××™×œ×ª×•×ª-select)
  
	3.2 [×©××™×œ×ª×•×ª UPDATE](#×©××™×œ×ª×•×ª-update)
  
	3.3 [×©××™×œ×ª×•×ª DELETE](#×©××™×œ×ª×•×ª-delete)

   	3.4 [××™×œ×•×¦×™×](#××™×œ×•×¦×™×)

	3.5 [COMMIT](#COMMIT)

   	3.6 [ROLLBACK](#ROLLBACK)

4. [×©×œ×‘ 3 - ××™× ×˜×’×¨×¦×™×”](#×©×œ×‘-3---××™× ×˜×’×¨×¦×™×”)

5. [×©×œ×‘ 4 - ×¤×•× ×§×¦×™×•×ª](#×©×œ×‘-4---×¤×•× ×§×¦×™×•×ª)

6. [×©×œ×‘ 5 - ×××©×§ ×’×¨×¤×™](#×©×œ×‘-5---×××©×§-×’×¨×¤×™)



---
## ××‘×•×

×”××¢×¨×›×ª ××™×•×¢×“×ª ×œ× ×™×”×•×œ ××™×“×¢ ××•×“×•×ª ××•×©×‘×•×ª ×—×œ×œ×™×•×ª. ×”× ×ª×•× ×™× ×”× ×©××¨×™× ×›×•×œ×œ×™× ××™×“×¢ ×¢×œ ×›×œ ×—×œ×œ×™×ª, ×”××©×™××•×ª ×©×œ×”, ×”×¦×™×•×“ ×‘×• × ×¢×©×” ×©×™××•×© ×‘××©×™××”, ×•×× ×©×™ ×”×¦×•×•×ª ×”×××›×œ×¡×™× ××ª ×”×—×œ×œ×™×ª. ×”×¤×•× ×§×¦×™×•× ×œ×™×•×ª ×”××¨×›×–×™×ª ×××¤×©×¨×ª ×”×•×¡×¤×ª ×—×œ×œ×™×ª ×—×“×©×”, ×‘× ×™×™×ª ×¦×•×•×ª ××¡×•×“×¨ ×¢× ×ª×¤×§×™×“×™× ××•×’×“×¨×™× ×œ×›×œ ××™×© ×¦×•×•×ª.

---
# ×©×œ×‘ 1 - ×¢×™×¦×•×‘ ×•×‘× ×™×™×ª ×‘×¡×™×¡ ×”× ×ª×•× ×™×

## ×ª×¨×©×™× ERD
![image](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/ERDAndDSTFiles/ERD.png?raw=true)

## ×ª×¨×©×™× DSD
![image](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/ERDAndDSTFiles/DSD.png?raw=true)

---

## ×©×™×˜×•×ª ×œ×”×›× ×¡×ª ×”× ×ª×•× ×™×

### ×™×¦×™×¨×ª × ×ª×•× ×™× ×‘××•×¤×Ÿ ××•×˜×•××˜×™
![generatedata](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/screenshots/generatedata.jpg?raw=true)

### ×™×™×‘×•× × ×ª×•× ×™× ××§×•×‘×¥ CSV
![import-from-csv](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/screenshots/import-from-csv.jpg?raw=true)

### ×”×›× ×¡×ª × ×ª×•× ×™× ×‘×××¦×¢×•×ª ×¡×§×¨×™×¤×˜ ×¤×™×™×ª×•×Ÿ
ğŸ“œ **[python script](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/programing/init-script.py)**

### ×”×›× ×¡×ª × ×ª×•× ×™× ×‘×××¦×¢×•×ª ×¡×§×¨×™×¤×˜ SQL
ğŸ“œ **[sql script](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/DataImportFiles/insert_Crew.sql)**

---
## ×¦×™×œ×•× ××¡×š ×’×™×‘×•×™ ×”× ×ª×•× ×™×
![backup](https://github.com/user-attachments/assets/f35b84fc-30e0-47f5-a0c6-b001a4fcc011)

---
## ×¦×™×œ×•× ××¡×š ×©×œ ×©×—×–×•×¨ ×”× ×ª×•× ×™× ×××—×©×‘ ××—×¨
![restore](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%90/screenshots/restore.jpg?raw=true)

---

# ×©×œ×‘ 2 - ×©××™×œ×ª×•×ª SQL

## ×©××™×œ×ª×•×ª SELECT

### 1. ×©××•×ª ×”×—×•×§×¨×™×, ×ª×—×•× ××—×§×¨, ×•×ª××¨×™×š ×”×¦×˜×¨×¤×•×ª ×©×œ ×”×¦×•×•×ª×™× ×”××ª××™××™× ×œ×”×
```sql
SELECT
	R.NAME,
	R.RESEARCH_FIELD,
	C.NAME AS CREW_NAME,
	C.JOINED_DATE
FROM
	RESEARCHER R
	JOIN CREW C ON R.CREW_ID = C.CREW_ID;
```
![select 1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-1.jpg?raw=true)

### 2. ×©××•×ª ×”×¦×•×•×ª×™×, ××¡×¤×¨ ×”××™×›×©×•×¨ ×©×©×•×™×š ×œ×›×œ ×¦×•×•×ª
```sql
SELECT
	C.NAME AS CREW_NAME,
	COUNT(U.EQUIPMENT_ID) AS EQUIPMENT_COUNT
FROM
	CREW C
	LEFT JOIN USES U ON C.CREW_ID = U.MISSION_ID
GROUP BY
	C.NAME;
```
![select 2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-2.jpg?raw=true)

### 3. ×¦×™×•×“ ×©××•×œ× ×‘×™×•×ª×¨ ×-3 ××©×™××•×ª
```sql
SELECT
	E.NAME AS EQUIPMENT_NAME,
	COUNT(U.MISSION_ID) AS MISSION_COUNT
FROM
	EQUIPMENT E
	JOIN USES U ON E.EQUIPMENT_ID = U.EQUIPMENT_ID
GROUP BY
	E.NAME
HAVING
	COUNT(U.MISSION_ID) > 3;
```
![select 3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-3.jpg?raw=true)

### 4. ×©××•×ª ×”××•×©×‘×•×ª ×©×”×•×§××• ×œ×¤× ×™ 2010 ×•×©×˜×— ×”×¦×™×•×“ ×©× ×¨×›×© ×œ×›×œ ××—×ª
```sql
SELECT
	COL.NAME,
	SUM(CURRENT_DATE - E.PURCHASE_DATE) AS TOTAL_EQUIPMENT_AGE -- ××—×©×‘ ××ª ×”×”×¤×¨×© ×‘×™××™× ×‘×™×Ÿ ×ª××¨×™×š ×¨×›×™×©×ª ×”×¦×™×•×“ ×œ×ª××¨×™×š ×”× ×•×›×—×™
FROM
	COLONY COL
	JOIN MISSION M ON COL.COLONY_ID = M.COLONY_ID
	JOIN USES U ON M.MISSION_ID = U.MISSION_ID
	JOIN EQUIPMENT E ON U.EQUIPMENT_ID = E.EQUIPMENT_ID
WHERE
	COL.ESTABLISHED_DATE < '2010-01-01'
GROUP BY
	COL.NAME;
```
![select 4](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-4.jpg?raw=true)

### 5. ×—×•×§×¨×™× ×‘×ª×¤×§×™×“ ×¡×¤×¦×™×¤×™ ×•×¦×•×•×ª×™× ×©×¦×•×¨×¤×• ××œ×™×”×
```sql
SELECT
	R.NAME AS RESEARCHER_NAME,
	C.NAME AS CREW_NAME,
	C.ROLE
FROM
	RESEARCHER R
	JOIN CREW C ON R.CREW_ID = C.CREW_ID
WHERE
	C.ROLE = 'Engineer';
```
![select 5](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-5.jpg?raw=true)

### 6. ××¡×¤×¨ ×—×•×§×¨×™× ×©× ××¦××™× ×‘×›×œ ×¦×•×•×ª
```sql
SELECT
	C.NAME AS CREW_NAME,
	COUNT(R.RESEARCHER_ID) AS RESEARCHER_COUNT
FROM
	CREW C
	LEFT JOIN RESEARCHER R ON C.CREW_ID = R.CREW_ID
GROUP BY
	C.NAME;
```
![select 6](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-6.jpg?raw=true)

### 7. ×¤×¨×˜×™ ×”××™×›×©×•×¨ ×©× ×¨×›×© ×œ××—×¨ 2015
```sql
SELECT
	E.NAME,
	E.PURCHASE_DATE
FROM
	EQUIPMENT E
WHERE
	E.PURCHASE_DATE > '2015-01-01';
```
![select 7](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-7.jpg?raw=true)

### 8. ××™×“×¢ ×¢×œ ×”×¦×•×•×ª×™× ×•×”××©×™××•×ª ×©×œ×”× ×‘-2019
```sql
SELECT
	C.NAME AS CREW_NAME,
	M.NAME AS MISSION_NAME,
	M.START_DATE
FROM
	CREW C
	JOIN MISSION M ON C.COLONY_ID = M.COLONY_ID
WHERE
	EXTRACT(
		YEAR
		FROM
			M.START_DATE
	) = 2019;
```
![select 8](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/select-8.jpg?raw=true)

---

## ×©××™×œ×ª×•×ª UPDATE

### 1. ×¢×“×›×•×Ÿ ×ª××¨×™×š ×”×¦×˜×¨×¤×•×ª ×©×œ ×¦×•×•×ª×™× ×©×”×¦×˜×¨×¤×• ×œ×¤× ×™ 2015

```sql
UPDATE CREW
SET JOINED_DATE = '2015-01-01'
WHERE JOINED_DATE < '2015-01-01';
```
![before update 1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-update-1.jpg?raw=true) - *before update 1*
![after update 1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-update-1.jpg?raw=true) - *after update 1*


### 2. ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×©×œ ×ª×©×ª×™×•×ª ×œ××•×©×‘×•×ª ×©×¤×¨×¡××• ××©×™××•×ª ×œ××—×¨ 2020

```sql
UPDATE INFRASTRUCTURE I
SET STATUS = 1
WHERE
	EXISTS (
		SELECT 1
		FROM COLONY C
			JOIN MISSION M ON C.COLONY_ID = M.COLONY_ID
		WHERE I.COLONY_ID = C.COLONY_ID
			AND M.START_DATE > '2020-01-01'
	);
```
![before update 2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-update-2.jpg?raw=true) - *before update 2*
![after update 2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-update-2.jpg?raw=true) - *after update 2*


### 3. ×¢×“×›×•×Ÿ ×ª×¤×§×™×“×™× ×©×œ ×—×•×§×¨×™× ×œ×¤×™ ×ª×—×•× ××—×§×¨

```sql
UPDATE CREW C
SET ROLE = 'Research Lead'
WHERE
	EXISTS (
		SELECT 1
		FROM RESEARCHER R
		WHERE R.CREW_ID = C.CREW_ID
			AND R.RESEARCH_FIELD = 'Elit LLC'
	);
```
![before update 3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-update-3.jpg?raw=true) - *before update 3*
![after update 3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-update-3.jpg?raw=true) - *after update 3*

---

## ×©××™×œ×ª×•×ª DELETE

### 1. ××—×™×§×ª ×©×™××•×© ×‘×¦×™×•×“ ×©×©×•×™×š ×œ×¤×—×•×ª ×œ-2 ××©×™××•×ª

```sql
DELETE FROM USES
WHERE
	EQUIPMENT_ID IN (
		SELECT E.EQUIPMENT_ID
		FROM EQUIPMENT E
			JOIN USES U ON E.EQUIPMENT_ID = U.EQUIPMENT_ID
		GROUP BY E.EQUIPMENT_ID
		HAVING COUNT(U.MISSION_ID) >= 2
	);
```
![before delete 1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-delete-1.jpg?raw=true) - *before delete 1*
![after delete 1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-delete-1.jpg?raw=true) - *after delete 1*

### 2. ××—×™×§×ª ×—×•×§×¨×™× ×©× ××¦××™× ×‘×¦×•×•×ª×™× ×©××‘×¦×¢×™× ××©×™××•×ª ××—×¨×™ 2020

```sql
DELETE FROM RESEARCHER
WHERE
	CREW_ID IN (
		SELECT C.CREW_ID
		FROM CREW C
			JOIN MISSION M ON C.COLONY_ID = M.COLONY_ID
		WHERE M.START_DATE > '2020-01-01'
	);
```
![before delete 2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-delete-2.jpg?raw=true) - *before delete 2*
![after delete 2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-delete-2.jpg?raw=true) - *after delete 2*

### 3. ××—×™×§×ª ×ª×©×ª×™×•×ª ×œ× ×¤×¢×™×œ×•×ª ××›×œ ×”××•×©×‘×•×ª

```sql
DELETE FROM INFRASTRUCTURE I WHERE I.STATUS = 2;
```
![before delete 3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/before-delete-3.jpg?raw=true) - *before delete 3*
![after delete 3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/after-delete-3.jpg?raw=true) - *after delete 3*

---

## ××™×œ×•×¦×™×

### 1. ×”×•×¡×¤×ª ××™×œ×•×¥ CHECK ×œ×˜×‘×œ×ª crew ×œ×•×•×“× ×©×ª×¤×§×™×“ ×œ× ×¨×™×§

```sql
ALTER TABLE crew ADD CONSTRAINT chk_role_not_empty CHECK (role <> '');
```
![constraint-1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/constraint-1.jpg?raw=true) - *constraint 1*

### 2. ×”×•×¡×¤×ª DEFAULT ×œ×ª××¨×™×š ×¨×›×™×©×” ×©×œ ×¦×™×•×“

```sql
ALTER TABLE equipment ALTER COLUMN purchase_date SET DEFAULT CURRENT_DATE;
```
![constraint-2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/constraint-2.jpg?raw=true) - *constraint 2*

### 3. ×”×•×¡×¤×ª NOT NULL ×œ-capacity ×‘×ª×©×ª×™×•×ª

```sql
ALTER TABLE infrastructure ALTER COLUMN capacity SET NOT NULL;
```
![constraint-3](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/constraint-3.jpg?raw=true) - *constraint 3*

---

## COMMIT

```sql
BEGIN;
UPDATE Crew SET role = 'Banana' WHERE crew_id = 1;
COMMIT;
```
![commit](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/commit.jpg?raw=true) - *after commit*

## ROLLBACK

```sql
BEGIN;
UPDATE Crew SET role = 'Banana' WHERE crew_id = 1;
ROLLBACK;
```
![rollback](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%91/screenshots/rollback.jpg?raw=true) - *after rollback*


---

# ×©×œ×‘ 3 - ××™× ×˜×’×¨×¦×™×”

××ª ×”××™× ×˜×’×¨×¦×™×” ×‘×™×¦×¢× ×• ×¢× ×××•×¨ ×•××¨×™. ×‘×©×œ×‘ ×”×–×” ×‘×™×¦×¢× ×• ××™× ×˜×’×¨×¦×™×” ×¢× ××¢×¨×›×ª ×œ× ×™×”×•×œ ××¡×¢×“×”. ×”×—×œ×˜× ×• ×œ×©×œ×‘ ××ª ×”××¢×¨×›×•×ª ×©×œ× ×• ×¢"×™ ×™×¦×™×¨×ª ×˜×‘×œ×” ×—×“×©×” People ×‘×” ×›×œ ×—×•×§×¨ ×”×•× ×’× ××œ×¦×¨ ×‘×©×¢×•×ª ×”×¢×¨×‘ ×‘××•×©×‘×” ×‘×” ×”×•× ×¢×•×‘×“. ××›×™×•×•×Ÿ ×©×”×—×•×§×¨×™× ×¨×•×¦×™× ×œ×”×¤×¨×™×“ ×‘×™×Ÿ×—×™×™ ×”××—×§×¨ ×œ×—×™×™ ×”××œ×¦×¨×•×ª ×©×œ×”× ×”× × ×›× ×¡×• ×œ××¢×¨×›×ª ×¢× ×©× ×©×•× ×” ×‘×™×Ÿ ×›×œ ×¢×‘×•×“×” ×•×¢× ×ª"×– ×©×•× ×”, ××‘×œ ×× ×—× ×• ××›×™×¨×™× ××•×ª× ×•×¨×•×¦×™× ×œ×¢×–×•×¨ ×œ×”× ×œ× ×”×œ ××ª ×”×–××Ÿ ×˜×•×‘ ×™×•×ª×¨ ×•×œ×›×Ÿ ×™×© ×œ× ×• ×˜×‘×œ×” ×‘×” ×©××•×¨ ×”×ª"×– ×©×œ ×›×œ ××—×“ ×‘×›×œ ×¢×‘×•×“×”. ×”×ª×¨×©×™××™× ×”×‘××™× ××¦×™×’×™× ××ª ×”××¢×¨×›×ª ×©×§×™×‘×œ× ×• ×•××ª ×”××¢×¨×›×ª ×”××©×•×œ×‘×ª:

## ×ª×¨×©×™××™×

### ×ª×¨×©×™× ×”-ERD ×©×§×™×‘×œ× ×•
![theirERD](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/ERDAndDSTFiles/theirERD.jpg?raw=true)

### ×ª×¨×©×™× ×”-DSD ×©×§×™×‘×œ× ×•
![theirDSD](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/ERDAndDSTFiles/theirDSD.jpg?raw=true)

### ×ª×¨×©×™× ×”-ERD ×”××©×•×œ×‘
![integratedERD](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/ERDAndDSTFiles/integratedERD.png?raw=true)

### ×ª×¨×©×™× ×”-DSD ×”××©×•×œ×‘
![integratedDSD](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/ERDAndDSTFiles/integratedDSD.png?raw=true)


## ××‘×˜×™×

### 1. ××¦×™×’ ×¤×¨×˜×™ ×”×–×× ×” ×‘××¡×¢×“×” ×›×•×œ×œ ×©× ×”×œ×§×•×—, ×¡×˜×˜×•×¡ ×”×”×–×× ×”, ××œ×¦×¨, ×•×©×™×˜×ª ×ª×©×œ×•×

``` sql
CREATE OR REPLACE VIEW View_Restaurant_Orders AS
SELECT
    r."RestOrder_ID",
    r."RestOrder_DateTime",
    c."Full_Name" AS customer_name,
    w."Full_Name" AS waiter_name,
    r."Total_price",
    r."StatusO	" AS order_status,
    p."Payment_Method",
    p."Payment_Status"
FROM "RestOrder" r
JOIN "Customer" c ON r."Customer_ID" = c."Customer_ID"
LEFT JOIN "Waiter" w ON r."Waiter_ID" = w."Waiter_ID"
JOIN "Payment" p ON r."Payment_ID" = p."Payment_ID";
```

#### ×©××™×œ×ª× 1 - ×›×œ ×”×”×–×× ×•×ª ×©×©×•×œ××• ×‘××©×¨××™

```sql
SELECT * FROM View_Restaurant_Orders WHERE "Payment_Method" = 'CreditCard' LIMIT 10;
```
![query1.1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/screenshots/query1.1.jpg?raw=true)

#### ×©××™×œ×ª× 2 - ×”×–×× ×•×ª ××¢×œ 100 ×©"×—

```sql
SELECT * FROM View_Restaurant_Orders WHERE "Total_price" > 100 LIMIT 10;
```
![query1.2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/screenshots/query1.2.jpg?raw=true)


### 2. ××¦×™×’ ×—×•×§×¨×™× ×œ×¤×™ ××•×©×‘×•×ª, ×›×•×œ×œ ×ª×—×•× ××—×§×¨, ×¦×•×•×ª ×•×©× ××•×©×‘×”.
```sql
CREATE OR REPLACE VIEW View_Colony_Researchers AS
SELECT
    r.researcher_id,
    r.name AS researcher_name,
    r.research_field,
    c.name AS crew_name,
    col.name AS colony_name,
    col.established_date
FROM researcher r
JOIN crew c ON r.crew_id = c.crew_id
JOIN colony col ON c.colony_id = col.colony_id;
```

#### ×©××™×œ×ª× 1 - ×¦×•×•×ª×™× ×‘××•×©×‘×•×ª ×©×”×•×§××• ××—×¨×™ 2020

```sql
SELECT crew_name FROM View_Colony_Researchers WHERE established_date > '2020-01-01' LIMIT 10;
```
![query2.1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/screenshots/query2.1.jpg?raw=true)

#### ×©××™×œ×ª× 2 - ×—×•×§×¨×™× ×‘××•×©×‘×•×ª ×©××ª×—×™×œ×•×ª ×‘-Ca

```sql
SELECT researcher_name FROM View_Colony_Researchers WHERE colony_name LIKE 'Ca%' LIMIT 10;
```
![query2.2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%92/screenshots/query2.2.jpg?raw=true)

---

# ×©×œ×‘ 4 - ×¤×•× ×§×¦×™×•×ª

## ×¤×•× ×§×¦×™×” 1 - ××—×©×‘×ª ×××•×¦×¢ ××—×™×¨×™× ×©×œ ×× ×•×ª
```sql
CREATE FUNCTION avg_dish_price() RETURNS REAL AS $$
DECLARE
    avg_price REAL;
BEGIN
    SELECT AVG(price) INTO avg_price FROM "Dish";
    RETURN avg_price;
END;
$$ LANGUAGE plpgsql;
```

## ×¤×•× ×§×¦×™×” 2 - ××—×–×™×¨×” REF CURSOR ×©×œ ×›×œ ×”×”×–×× ×•×ª ×‘×¡×˜×˜×•×¡ ××¡×•×™×
```sql
CREATE FUNCTION get_orders_by_status(status_input order_status) RETURNS refcursor AS $$
DECLARE
    cur refcursor := 'get_orders_by_status';
BEGIN
    OPEN cur FOR SELECT * FROM "RestOrder" WHERE "StatusO	" = status_input;
    RETURN cur;
END;
$$ LANGUAGE plpgsql;
```

## ×¤×¨×•×¦×“×•×¨×” 1 - ×¢×“×›×•×Ÿ ×¡×˜×˜×•×¡ ×”×–×× ×”
```sql
CREATE PROCEDURE update_order_status(order_id INT, new_status order_status) AS $$
BEGIN
    UPDATE "RestOrder" SET "StatusO	" = new_status WHERE "RestOrder_ID" = order_id;
END;
$$ LANGUAGE plpgsql;
```

## ×¤×¨×•×¦×“×•×¨×” 2 - ×¤×¨×•×¦×“×•×¨×” ×¢× CURSOR, ×œ×•×œ××” ×•-EXCEPTION
```sql
CREATE PROCEDURE update_all_orders_to_completed() AS $$
DECLARE
    r RECORD;
    cur CURSOR FOR SELECT "RestOrder_ID" FROM "RestOrder" WHERE "StatusO	" != 'Completed';
BEGIN
    OPEN cur;
    LOOP
        FETCH cur INTO r;
        EXIT WHEN NOT FOUND;
        BEGIN
            UPDATE "RestOrder" SET "StatusO	" = 'Completed' WHERE "RestOrder_ID" = r."RestOrder_ID";
        EXCEPTION WHEN OTHERS THEN
            RAISE NOTICE '×©×’×™××” ×‘×”×–×× ×” %', r."RestOrder_ID";
        END;
    END LOOP;
    CLOSE cur;
END;
$$ LANGUAGE plpgsql;
```

## ×˜×¨×™×’×¨ 1 - ×˜×¨×™×’×¨ ×œ×¢×“×›×•×Ÿ ×ª××¨×™×š ×‘×¨×›×™×©×” ×—×“×©×”
```sql
CREATE OR REPLACE FUNCTION set_payment_date() RETURNS trigger AS $$
BEGIN
    NEW."Payment_Date" := CURRENT_DATE;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_set_payment_date
BEFORE INSERT ON "Payment"
FOR EACH ROW EXECUTE FUNCTION set_payment_date();
```

## ×˜×¨×™×’×¨ 2 - ×˜×¨×™×’×¨ ×œ×•×•×™×“×•× ××—×™×¨ ×× ×” ×—×™×•×‘×™
```sql
CREATE OR REPLACE FUNCTION check_dish_price() RETURNS trigger AS $$
BEGIN
    IF NEW.price <= 0 THEN
        RAISE EXCEPTION '××—×™×¨ ×œ× ×ª×§×™×Ÿ!';
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER trg_check_dish_price
BEFORE INSERT OR UPDATE ON "Dish"
FOR EACH ROW EXECUTE FUNCTION check_dish_price();
```

## ×ª×•×›× ×™×ª 1 - ××–×× ×ª ×¤×•× ×§×¦×™×” ×•×¤×¨×•×¦×“×•×¨×” - ××—×©×‘×ª ×××•×¦×¢ ××—×™×¨×™× ×•××¢×“×›× ×ª ×¡×˜×˜×•×¡ ×œ×”×–×× ×”

### ××” ×”×ª×•×›× ×™×ª ×¢×•×©×”?

×”×ª×•×›× ×™×ª ××—×©×‘×ª ××ª ×”××—×™×¨ ×”×××•×¦×¢ ×©×œ ×× ×•×ª (dishes) ×¢×œ ×™×“×™ ×§×¨×™××” ×œ×¤×•× ×§×¦×™×”, ×•×œ××—×¨ ××›×Ÿ ××¢×“×›× ×ª ××ª ×”×¡×˜×˜×•×¡ ×©×œ ×”×–×× ×” ×¡×¤×¦×™×¤×™×ª (×¢× ××–×”×” 1) ×œ'Confirmed' (××•×©×¨).

```sql
DO $$
DECLARE
    avg_price REAL;
BEGIN
    avg_price := avg_dish_price();
    CALL update_order_status(1, 'Confirmed');
END;
$$;
```

![run-main-1](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%93/screenshots/run-main1.jpg?raw=true)

## ×ª×•×›× ×™×ª 2 - ××–×× ×ª ×¤×•× ×§×¦×™×” ×¢× REF CURSOR ×•×¤×¨×•×¦×“×•×¨×” - ××“×¤×™×¡×” ××–×”×™ ×”×–×× ×•×ª ×‘×¡×˜×˜×•×¡ "Pending" ×•××¢×“×›× ×ª ××ª ×›×•×œ×Ÿ ×œÖ¾Completed.

### ××” ×”×ª×•×›× ×™×ª ×¢×•×©×”?

×”×ª×•×›× ×™×ª ×©×•×œ×¤×ª ××ª ×›×œ ×”×”×–×× ×•×ª ××ª×•×š ×˜×‘×œ×ª "RestOrder" ×©× ××¦××•×ª ×‘××¦×‘ 'Pending' (×××ª×™×Ÿ), ××“×¤×™×¡×” ××ª ××–×”×” ×›×œ ×”×–×× ×” ×©× ××¦××”, ×•×œ××—×¨ ××›×Ÿ ××¢×“×›× ×ª ××ª ×›×œ ×”×”×–×× ×•×ª ×‘×˜×‘×œ×” ×œ××¦×‘ 'Completed' (×”×•×©×œ×).

```sql
DO $$
DECLARE
    cur refcursor;
    row "RestOrder"%ROWTYPE;
BEGIN
    cur := get_orders_by_status('Pending');
    LOOP
        FETCH cur INTO row;
        EXIT WHEN NOT FOUND;
        RAISE NOTICE '×”×–×× ×”: %', row."RestOrder_ID";
    END LOOP;
    CALL update_all_orders_to_completed();
END;
$$;

```

![run-main-2](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%93/screenshots/run-main2.jpg?raw=true)

---
# ×©×œ×‘ 5 - ×××©×§ ×’×¨×¤×™

×‘×©×œ×‘ ×–×” ×¤×™×ª×—× ×• ×××©×§ ×’×¨×¤×™ ×‘×¢×–×¨×ª Python ×•Ö¾PyQt5. ×”×××©×§ ×××¤×©×¨ ×’×™×©×” × ×•×—×” ×•×¤×©×•×˜×” ×œ×¤×¢×•×œ×•×ª ×¢×œ ×‘×¡×™×¡ ×”× ×ª×•× ×™× â€“ ×›×•×œ×œ ×”×¦×’×ª ×˜×‘×œ××•×ª, ×”×¨×¦×ª ×©××™×œ×ª×•×ª, ×•×”×¤×¢×œ×ª ×¤×•× ×§×¦×™×•×ª ×•×¤×¨×•×¦×“×•×¨×•×ª.

## ×”×ª×§× ×”

×œ×”×ª×§× ×ª ×”×ª×œ×•×™×•×ª ×™×© ×œ×”×¨×™×¥:

```cmd
pip install pyqt5 psycopg2
```

×™×© ×œ×•×•×“× ×©××¡×“ ×”× ×ª×•× ×™× PostgreSQL ×¨×¥, ×•×©×§×•×‘×¥ ×”×”×’×“×¨×•×ª config.json ×›×•×œ×œ ×¤×¨×˜×™ ×—×™×‘×•×¨ ×ª×§×™× ×™×.

## ×”×¨×¦×”

×œ×”×¤×¢×œ×ª ×”××¤×œ×™×§×¦×™×”:

```cmd
python MainApp.py
```

×”××¤×œ×™×§×¦×™×” ×ª×¤×ª×— ×‘×—×œ×•×Ÿ ×’×¨×¤×™ ×”××¦×™×’ ××ª ×”×ª×¤×¨×™×˜ ×”×¨××©×™ ×¢× ×›×¤×ª×•×¨×™× ×œ×’×™×©×” ×œ×˜×‘×œ××•×ª, ×”×¤×¢×œ×ª ×©××™×œ×ª×•×ª, ×•×ª×¤×¢×•×œ ×¤×¨×•×¦×“×•×¨×•×ª.
×”×¢×™×¦×•×‘ × ×§×™, ×¢× ×¦×‘×¢×™× × ×¢×™××™× (×›×—×•×œ/×ª×›×œ×ª), ×—×œ×•×§×” × ×•×—×” ×œ×œ×©×•× ×™×•×ª, ×•×˜×¤×¡×™× ×§×œ×™× ×œ×©×™××•×©.

## ×¦×™×œ×•××™ ××¡×š

### ××¡×š ×¨××©×™

![main-screen](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/main-screen.jpg?raw=true)

### ×”×›× ×¡×ª ×©×•×¨×” ×—×“×©×”

![insert-screen](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/insert-screen.jpg?raw=true)

### ×¢×“×›×•×Ÿ ×©×•×¨×”

![update-screen](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/update-screen.jpg?raw=true)

### ××—×™×§×ª ×©×•×¨×”

![delete-screen](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/delete-screen.jpg?raw=true)

### ×”×¨×¦×ª ×¤×•× ×§×¦×™×•×ª ×•×¤×¨×•×¦×“×•×¨×•×ª

![run-func-proc](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/run-func-proc-window.jpg?raw=true)

### ×”×¨×¦×ª ×©××™×œ×ª×•×ª

![run-queries-window](https://github.com/H-Ariel/DBProject_0644_3156/blob/main/%D7%A9%D7%9C%D7%91%20%D7%94/screenshots/run-queries-window.jpg?raw=true)

---

×ª×•×“×” ×©×”×’×¢×ª× ×¢×“ ×›××Ÿ :)


